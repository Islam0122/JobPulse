.PHONY: help install migrate run test clean docker-build docker-up docker-down setup dev redis celery beat

RED=\033[0;31m
GREEN=\033[0;32m
YELLOW=\033[1;33m
BLUE=\033[0;34m
NC=\033[0m

help:
	@echo "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo "${GREEN}           JobPulse Django Project${NC}"
	@echo "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo ""
	@echo "${YELLOW}ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°:${NC}"
	@echo "  ${GREEN}make setup${NC}          - ðŸš€ ÐŸÐ¾Ð»Ð½Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð¾Ð´Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ°)"
	@echo "  ${GREEN}make install${NC}        - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹"
	@echo "  ${GREEN}make migrate${NC}        - Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹"
	@echo "  ${GREEN}make fixtures${NC}       - Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…"
	@echo ""
	@echo "${YELLOW}ðŸƒ Ð—Ð°Ð¿ÑƒÑÐº:${NC}"
	@echo "  ${GREEN}make dev${NC}            - ðŸŽ¯ Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ (Django+Redis+Celery)"
	@echo "  ${GREEN}make run${NC}            - Ð—Ð°Ð¿ÑƒÑÐº Django ÑÐµÑ€Ð²ÐµÑ€Ð°"
	@echo "  ${GREEN}make redis${NC}          - Ð—Ð°Ð¿ÑƒÑÐº Redis ÑÐµÑ€Ð²ÐµÑ€Ð°"
	@echo "  ${GREEN}make celery${NC}         - Ð—Ð°Ð¿ÑƒÑÐº Celery worker"
	@echo "  ${GREEN}make beat${NC}           - Ð—Ð°Ð¿ÑƒÑÐº Celery beat"
	@echo ""
	@echo "${YELLOW}ðŸ³ Docker ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:${NC}"
	@echo "  ${GREEN}make docker-setup${NC}   - ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² Docker (Ð¾Ð´Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ°)"
	@echo "  ${GREEN}make docker-build${NC}   - Ð¡Ð±Ð¾Ñ€ÐºÐ° Docker Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²"
	@echo "  ${GREEN}make docker-up${NC}      - Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²"
	@echo "  ${GREEN}make docker-down${NC}    - ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²"
	@echo "  ${GREEN}make docker-logs${NC}    - ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²"
	@echo "  ${GREEN}make docker-restart${NC} - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²"
	@echo ""
	@echo "${YELLOW}ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°:${NC}"
	@echo "  ${GREEN}make test${NC}           - Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²"
	@echo "  ${GREEN}make test-redis${NC}     - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Redis"
	@echo "  ${GREEN}make check${NC}          - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"
	@echo ""
	@echo "${YELLOW}ðŸ—„ï¸ Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…:${NC}"
	@echo "  ${GREEN}make superuser${NC}      - Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"
	@echo "  ${GREEN}make shell${NC}          - Django shell"
	@echo "  ${GREEN}make dbshell${NC}        - Database shell"
	@echo ""
	@echo "${YELLOW}ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°:${NC}"
	@echo "  ${GREEN}make clean${NC}          - ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²"
	@echo "  ${GREEN}make clean-all${NC}      - ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð‘Ð” Ð¸ ÐºÑÑˆ)"
	@echo ""
	@echo "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

setup: check-env
	@echo "${GREEN}ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°...${NC}"
	@$(MAKE) install
	@$(MAKE) create-env
	@$(MAKE) migrate
	@$(MAKE) create-test-data
	@$(MAKE) collectstatic
	@echo ""
	@echo "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo "${GREEN}âœ… ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½!${NC}"
	@echo "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo ""
	@echo "${YELLOW}ðŸ“‹ Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸:${NC}"
	@echo "   Telegram ID: 123456789 - john_doe (Backend Developer)"
	@echo "   Telegram ID: 987654321 - jane_smith (Frontend Developer)"
	@echo "   Telegram ID: 555555555 - alex_tech (Full Stack Developer)"
	@echo ""
	@echo "${YELLOW}ðŸŒ Ð”Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾:${NC}"
	@echo "   ${GREEN}make dev${NC} - Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ Django, Redis, Celery"
	@echo ""
	@echo "${YELLOW}ðŸ³ Ð”Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð² Docker:${NC}"
	@echo "   ${GREEN}make docker-setup${NC}"
	@echo ""
	@echo "${YELLOW}ðŸ“š API Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°:${NC}"
	@echo "   http://localhost:8000/api/swagger/"
	@echo "   http://localhost:8000/admin/"
	@echo ""


dev:
	@echo "${GREEN}ðŸŽ¯ Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾...${NC}"
	@echo "${YELLOW}ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽ 4 Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð°:${NC}"
	@echo "  1. Django Server"
	@echo "  2. Redis Server"
	@echo "  3. Celery Worker"
	@echo "  4. Celery Beat"
	@echo ""
	@if command -v gnome-terminal > /dev/null; then \
		gnome-terminal --tab --title="Django" -- bash -c "cd $(PWD) && source venv/bin/activate && python manage.py runserver; exec bash" & \
		sleep 1; \
		gnome-terminal --tab --title="Redis" -- bash -c "redis-server; exec bash" & \
		sleep 2; \
		gnome-terminal --tab --title="Celery Worker" -- bash -c "cd $(PWD) && source venv/bin/activate && celery -A config worker -l info; exec bash" & \
		gnome-terminal --tab --title="Celery Beat" -- bash -c "cd $(PWD) && source venv/bin/activate && celery -A config beat -l info; exec bash" & \
		echo "${GREEN}âœ… Ð’ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!${NC}"; \
	elif command -v osascript > /dev/null; then \
		osascript -e 'tell app "Terminal" to do script "cd $(PWD) && source venv/bin/activate && python manage.py runserver"' & \
		sleep 1; \
		osascript -e 'tell app "Terminal" to do script "redis-server"' & \
		sleep 2; \
		osascript -e 'tell app "Terminal" to do script "cd $(PWD) && source venv/bin/activate && celery -A config worker -l info"' & \
		osascript -e 'tell app "Terminal" to do script "cd $(PWD) && source venv/bin/activate && celery -A config beat -l info"' & \
		echo "${GREEN}âœ… Ð’ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!${NC}"; \
	else \
		echo "${RED}âŒ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½${NC}"; \
		echo "${YELLOW}Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð°Ñ…:${NC}"; \
		echo "  Terminal 1: ${GREEN}make run${NC}"; \
		echo "  Terminal 2: ${GREEN}make redis${NC}"; \
		echo "  Terminal 3: ${GREEN}make celery${NC}"; \
		echo "  Terminal 4: ${GREEN}make beat${NC}"; \
	fi


docker-setup:
	@echo "${GREEN}ðŸ³ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² Docker...${NC}"
	@$(MAKE) docker-build
	@$(MAKE) docker-up
	@sleep 5
	@docker-compose exec web python manage.py migrate
	@docker-compose exec web python manage.py create_test_users
	@docker-compose exec web python manage.py collectstatic --noinput
	@echo ""
	@echo "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo "${GREEN}âœ… Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!${NC}"
	@echo "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
	@echo ""
	@echo "${YELLOW}ðŸŒ Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹:${NC}"
	@echo "   Django:     http://localhost:8000"
	@echo "   Swagger:    http://localhost:8000/api/swagger/"
	@echo "   Admin:      http://localhost:8000/admin/"
	@echo "   PostgreSQL: localhost:5432"
	@echo "   Redis:      localhost:6379"
	@echo ""
	@echo "${YELLOW}ðŸ“Š ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:${NC}"
	@echo "   ${GREEN}make docker-logs${NC}    - ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²"
	@echo "   ${GREEN}make docker-down${NC}    - ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹"
	@echo "   ${GREEN}make docker-restart${NC} - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ"
	@echo ""

install:
	@echo "${GREEN}ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹...${NC}"
	@if [ ! -d "venv" ]; then \
		echo "${YELLOW}Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ...${NC}"; \
		python3 -m venv venv; \
	fi
	@echo "${YELLOW}ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ venv Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²...${NC}"
	@. venv/bin/activate && pip install --upgrade pip && pip install -r requirements.txt
	@echo "${GREEN}âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹${NC}"

create-env:
	@if [ ! -f ".env" ]; then \
		echo "${YELLOW}ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°...${NC}"; \
		cp .env.example .env; \
		echo "${GREEN}âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½ .env Ñ„Ð°Ð¹Ð»${NC}"; \
		echo "${YELLOW}âš ï¸  ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ .env Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°!${NC}"; \
	else \
		echo "${BLUE}â„¹ï¸  .env Ñ„Ð°Ð¹Ð» ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚${NC}"; \
	fi

migrate:
	@echo "${GREEN}ðŸ—„ï¸  Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹...${NC}"
	@. venv/bin/activate && python manage.py makemigrations
	@. venv/bin/activate && python manage.py migrate
	@echo "${GREEN}âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ñ‹${NC}"

create-test-data:
	@echo "${GREEN}ðŸ‘¥ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…...${NC}"
	@. venv/bin/activate && python manage.py create_test_users
	@echo "${GREEN}âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹${NC}"

collectstatic:
	@echo "${GREEN}ðŸŽ¨ Ð¡Ð±Ð¾Ñ€ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²...${NC}"
	@. venv/bin/activate && python manage.py collectstatic --noinput
	@echo "${GREEN}âœ… Ð¡Ñ‚Ð°Ñ‚Ð¸ÐºÐ° ÑÐ¾Ð±Ñ€Ð°Ð½Ð°${NC}"


run:
	@echo "${GREEN}ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Django ÑÐµÑ€Ð²ÐµÑ€Ð°...${NC}"
	@. venv/bin/activate && python manage.py runserver

redis:
	@echo "${GREEN}ðŸ”´ Ð—Ð°Ð¿ÑƒÑÐº Redis ÑÐµÑ€Ð²ÐµÑ€Ð°...${NC}"
	@if command -v redis-server > /dev/null; then \
		redis-server; \
	else \
		echo "${RED}âŒ Redis Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: brew install redis Ð¸Ð»Ð¸ apt install redis${NC}"; \
	fi

celery:
	@echo "${GREEN}ðŸ”„ Ð—Ð°Ð¿ÑƒÑÐº Celery worker...${NC}"
	@. venv/bin/activate && celery -A config worker -l info

beat:
	@echo "${GREEN}â° Ð—Ð°Ð¿ÑƒÑÐº Celery beat...${NC}"
	@. venv/bin/activate && celery -A config beat -l info

docker-build:
	@echo "${GREEN}ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ° Docker Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²...${NC}"
	@docker-compose build
	@echo "${GREEN}âœ… ÐžÐ±Ñ€Ð°Ð·Ñ‹ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹${NC}"

docker-up:
	@echo "${GREEN}â¬†ï¸  Ð—Ð°Ð¿ÑƒÑÐº Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²...${NC}"
	@docker-compose up -d
	@echo "${GREEN}âœ… ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹${NC}"

docker-down:
	@echo "${YELLOW}â¬‡ï¸  ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²...${NC}"
	@docker-compose down
	@echo "${GREEN}âœ… ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹${NC}"

docker-restart:
	@echo "${YELLOW}ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²...${NC}"
	@$(MAKE) docker-down
	@$(MAKE) docker-up
	@echo "${GREEN}âœ… ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹${NC}"

docker-logs:
	@echo "${BLUE}ðŸ“‹ ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² (Ctrl+C Ð´Ð»Ñ Ð²Ñ‹Ñ…Ð¾Ð´Ð°)...${NC}"
	@docker-compose logs -f

docker-ps:
	@echo "${BLUE}ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²:${NC}"
	@docker-compose ps

test:
	@echo "${GREEN}ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²...${NC}"
	@. venv/bin/activate && pytest

test-redis:
	@echo "${GREEN}ðŸ”´ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Redis...${NC}"
	@. venv/bin/activate && python manage.py test_redis

check:
	@echo "${BLUE}ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°...${NC}"
	@. venv/bin/activate && python manage.py check
	@echo "${GREEN}âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°${NC}"


superuser:
	@echo "${GREEN}ðŸ‘¤ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ...${NC}"
	@. venv/bin/activate && python manage.py createsuperuser

shell:
	@echo "${GREEN}ðŸš Django shell...${NC}"
	@. venv/bin/activate && python manage.py shell

dbshell:
	@echo "${GREEN}ðŸ—„ï¸  Database shell...${NC}"
	@. venv/bin/activate && python manage.py dbshell


clean:
	@echo "${YELLOW}ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²...${NC}"
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@find . -type f -name "*.pyo" -delete 2>/dev/null || true
	@find . -type f -name "*.log" -delete 2>/dev/null || true
	@rm -rf .pytest_cache 2>/dev/null || true
	@rm -rf htmlcov 2>/dev/null || true
	@rm -rf .coverage 2>/dev/null || true
	@rm -rf celerybeat-schedule 2>/dev/null || true
	@echo "${GREEN}âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°${NC}"

clean-all: clean
	@echo "${RED}ðŸ§¹ ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° (Ð‘Ð”, ÐºÑÑˆ, venv)...${NC}"
	@rm -rf db.sqlite3 2>/dev/null || true
	@rm -rf staticfiles 2>/dev/null || true
	@rm -rf media 2>/dev/null || true
	@echo "${YELLOW}âš ï¸  Ð”Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ venv Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ: rm -rf venv${NC}"
	@echo "${GREEN}âœ… ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°${NC}"


check-env:
	@command -v python3 >/dev/null 2>&1 || { echo "${RED}âŒ Python3 Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½${NC}"; exit 1; }
	@command -v pip >/dev/null 2>&1 || { echo "${RED}âŒ Pip Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½${NC}"; exit 1; }
	@echo "${GREEN}âœ… Python Ð¸ Pip ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹${NC}"

requirements:
	@echo "${GREEN}ðŸ“‹ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ requirements.txt...${NC}"
	@. venv/bin/activate && pip freeze > requirements.txt
	@echo "${GREEN}âœ… requirements.txt Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½${NC}"